---
# tasks file for webserver

- name: opdater alle pakker
  yum: 
    name: '*' 
    state: latest
    update_cache: yes

- name: Installer seneste udgave af Apache
  yum:
    name: httpd
    state: latest


- name: Enable Service (Httpd, Firewalld)
  ansible.builtin.systemd:
    name: "{{ item }}"
  with_items:
    - httpd
    - firewalld

- name: kør bash command til kopiering af config filer
  ansible.builtin.command: cp /etc/httpd/conf/httpd.conf /backup/
  become: yes

- name: insert hjemmeside index.html fil
  ansible.builtin.template:
    src: index.html
    dest: /var/www/html/index.html
    owner: root
    group: wheel
    mode: 754
  become: yes
  notify: 
      - Make sure httpd unit is running


- name: insert hjemmeside config fil.
  ansible.builtin.template:
    src: httpd.conf
    dest: /etc/httpd/conf/httpd.conf
    group: wheel
    mode: 644
  become: yes
  notify: 
      - Make sure httpd unit is running

#- name: Adding dmz zone and activating
#  ansible.posix.firewalld:
#    zone: dmz
#    interface: eth0
#    permanent: yes
#    state: enabled
#    notify
#        - Make sure firewalld service is restarted
    
- name: firewalld regler på relevante service ports.
  ansible.posix.firewalld:
    service: "{{ item }}"
    state: enabled
    permanent: true
  with_items:
    - http
    - ssh
  notify:
      - Make sure firewalld unit is running
      - Make sure firewalld service is restarted
